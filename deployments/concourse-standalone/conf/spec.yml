---
subsys:
  name: concourse-standalone
  type: bosh-deployment
  depends_on:
    - (( replace ))
    - traefik-concourse
  upstream: easyfoundry-gbe/deployments/concourse

input_resources:
  - (( merge ))
  - name: easyfoundry-gbe
    type: subsys-upstream
    uri: https://github.com/gstackio/gstack-bosh-environment.git
    version: "5ab4eea" # master as of 2019-03-03


sanity-tests:
  concourse-target: gk # like Gstack


# main_deployment_file: ""

operations_files: null
operations_files:
  10_local: (( prune ))
  10_easyfoundry-gbe:
    - (( replace ))
    - deployments/concourse/features/reorder-instance-groups # must appear first, before anything is modified in instance group 'db'
  20_concourse-deployment:
    - (( replace ))
    - cluster/operations/worker-ephemeral-disk
    - cluster/operations/encryption
    - cluster/operations/tls
    - cluster/operations/tls-vars
  30_local: (( prune ))
  30_easyfoundry-gbe:
    - (( replace ))
    - deployments/concourse/features/pin-stemcell
    - deployments/concourse/features/set-log-level
    - deployments/concourse/features/basic-auth-with-vars  # replaces 'cluster/operations/basic-auth'
    - deployments/concourse/features/encryption-vars       # augments 'cluster/operations/encryption'
    - deployments/concourse/features/credhub-integration-with-uaa-and-db-tls
  40_local:
    - (( replace ))
    - routing
    - static-web
    - scale-for-minimal-downtime-upgrades


# variables_files: {}


deployment_vars:
  deployment_name: concourse


  # User-facing settings

  external_host: ci.example.com


  # Versions

  os_conf_version: "20.0.0"
  os_conf_sha1: a60187f038d45e2886db9df82b72a9ab5fdcc49d

  bosh_dns_aliases_version: "0.0.3"
  bosh_dns_aliases_sha1: b0d0a0350ed87f1ded58b2ebb469acea0e026ccc

  credhub_version: "2.1.2"
  credhub_sha1:    754a24dbffe8bc5efce7e698d935b5f4df541f38

  uaa_version: "70.0"
  uaa_sha1: c23b71fb2a3d01a1f494753b7f00ae40c549838f

  bpm_version: "1.0.3"
  bpm_sha1: 2875a69cae225fa97fe3faae1e9fbacff61e2dc5

  # stemcell_os:              # imported below
  # stemcell_version:         # imported below
  # stemcell_sha1:            # imported below


  # Scaling properties

  db_persistent_disk_type: 20GB


  # Reference declarations

  web_ip0: 10.244.16.67
  web_ip1: 10.244.16.68
  atc_tls_bind_port: 4443
  web_network_vm_extension: (( prune ))


imported_vars:
  - (( replace ))
  - subsys: traefik-concourse
    imports:

      - name: stemcell_os
        from: depl-vars
        path: /stemcell_os
      - name: stemcell_version
        from: depl-vars
        path: /stemcell_version
      - name: stemcell_sha1
        from: depl-vars
        path: /stemcell_sha1
